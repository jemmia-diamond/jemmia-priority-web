<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta charset="UTF-8" />
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-S7Q7M2B9DJ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-S7Q7M2B9DJ");
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Specific Metas -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, viewport-fit=cover"
    />
    <title>Jemmia Priority - Profile detail</title>
    <!-- Favicon and Touch Icons  -->
    <link rel="shortcut icon" href="images/logo.png" />
    <link rel="apple-touch-icon-precomposed" href="images/logo.png" />
    <!-- Font -->
    <link rel="stylesheet" href="fonts/fonts.css" />
    <!-- Icons -->
    <link rel="stylesheet" href="fonts/icons-alipay.css" />
    <link rel="stylesheet" href="styles/bootstrap.css" />

    <link rel="stylesheet" type="text/css" href="styles/styles.css" />
    <link
      rel="manifest"
      href="_manifest.json"
      data-pwa-version="set_in_manifest_and_pwa_js"
    />
    <link rel="apple-touch-icon" sizes="192x192" href="images/logo.png" />

    <style>
      button {
        padding: 6px 1px !important;
      }
    </style>
  </head>

  <body class="">
    <!-- preloade -->

    <!-- /preload -->
    <div class="header">
      <div class="tf-container">
        <div
          class="tf-statusbar d-flex justify-content-center align-items-center"
        >
          <a style="outline: none" href="#" class="back-btn">
            <i class="icon-left"></i>
          </a>
          <h3>Trang cá nhân</h3>
          <!-- <a href="#" id="btn-popup-up" class="action-right"><i class="icon icon-filter"></i> </a> -->
        </div>
      </div>
    </div>

    <div class="mt-1">
      <div class="tf-container">
        <div class="box-user">
          <div
            class="inner d-flex flex-column align-items-center justify-content-center"
          >
            <div class="box-avatar">
              <img src="images/logo.jpg" loading="eager" alt="image" />
              <!-- <span class="icon-camera-to-take-photos"></span> -->
            </div>
            <div class="info">
              <h2 class="fw_8 mt-3 text-center" id="name">Themesflat</h2>
              <!-- <p>0321 0000 2342 2424 <i class="icon-copy1"></i></p> -->
            </div>
          </div>
        </div>
        <div class="mt-7">
          <!-- <li class="list-user-info">
            <span class="icon-user"></span
            ><a href="71_change-name.html" id="name">Themesflat</a>
          </li> -->
          <li class="list-user-info">
            <span class="icon-credit-card2"></span>
            <p id="rank"></p>
          </li>
          <li class="list-user-info">
            <span class="icon-phone"></span>
            <p id="phone"></p>
          </li>
          <!--  -->
          <li class="list-user-info">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
            >
              <path
                fill="black"
                d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4l-8 5l-8-5V6l8 5l8-5z"
              />
            </svg>
            <p id="email"></p>
          </li>
          <!--  -->
          <li class="list-user-info">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
            >
              <g fill="none">
                <rect
                  width="18"
                  height="15"
                  x="3"
                  y="6"
                  stroke="black"
                  stroke-width="2"
                  rx="2"
                />
                <path
                  fill="black"
                  d="M3 10c0-1.886 0-2.828.586-3.414C4.172 6 5.114 6 7 6h10c1.886 0 2.828 0 3.414.586C21 7.172 21 8.114 21 10z"
                />
                <path
                  stroke="black"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M7 3v3m10-3v3"
                />
                <rect width="4" height="2" x="7" y="12" fill="black" rx=".5" />
                <rect width="4" height="2" x="7" y="16" fill="black" rx=".5" />
                <rect width="4" height="2" x="13" y="12" fill="black" rx=".5" />
                <rect width="4" height="2" x="13" y="16" fill="black" rx=".5" />
              </g>
            </svg>
            <p id="date"></p>
          </li>
          <!--  -->
          <li class="list-user-info">
            <img
              style="width: 24px; height: 24px; object-fit: cover"
              src="/images/ref/Gender.svg"
              alt=""
            />
            <p id="gender"></p>
          </li>
          <!--  -->
          <li class="list-user-info">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 512 512"
            >
              <path
                fill="none"
                stroke="black"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="32"
                d="m35.42 188.21l207.75 269.46a16.17 16.17 0 0 0 25.66 0l207.75-269.46a16.52 16.52 0 0 0 .95-18.75L407.06 55.71A16.22 16.22 0 0 0 393.27 48H118.73a16.22 16.22 0 0 0-13.79 7.71L34.47 169.46a16.52 16.52 0 0 0 .95 18.75M48 176h416"
              />
              <path
                fill="none"
                stroke="black"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="32"
                d="m400 64l-48 112l-96-128M112 64l48 112l96-128m0 400l-96-272m96 272l96-272"
              />
            </svg>
            <p id="points"></p>
          </li>
          <button
            data-bs-toggle="modal"
            data-bs-target="#update"
            class="tf-btn accent large mt-5"
          >
            <span>Yêu cầu cập nhật</span>
          </button>

          <div class="modal fade" id="update">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content" style="border-radius: 14px">
                <div class="modal-body d-flex flex-column">
                  <section>
                    <div class="group-input position-relative">
                      <span>Email</span>
                      <input type="text" placeholder="Email" id="pop_email" />
                      <span class="text-danger" id="validEmail"></span>
                    </div>
                    <div class="group-input position-relative">
                      <span>Ngày sinh</span>
                      <input
                        type="date"
                        placeholder="Ngày sinh"
                        id="pop_date"
                      />
                      <span class="text-danger" id="validDate"></span>
                    </div>
                  </section>
                  <section class="d-flex justify-content-end gap-1 text-black">
                    <button
                      data-bs-dismiss="modal"
                      class="d-flex justify-content-center"
                      style="width: 130px; color: black"
                    >
                      <span>Đóng</span>
                    </button>
                    <button
                      disabled
                      data-bs-toggle="modal"
                      data-bs-target="#notifyModal"
                      id="sendUpdate"
                      style="width: 130px; color: black; opacity: 0.2"
                      class="tf-btn accent text-white"
                    >
                      Gửi
                    </button>
                  </section>
                </div>
              </div>
            </div>
          </div>

          <div class="modal fade" id="notifyModal">
            <div class="modal-dialog modal-dialog-centered" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <!-- <h5 class="modal-title">Modal title</h5> -->
                  <img
                    src="./images/rewards/Icon Success.png"
                    class=""
                    style="position: absolute; width: 50%; left: 25%"
                    alt=""
                  />
                </div>
                <div class="modal-body mt-5">
                  <div class="d-flex flex-column text-center gap-3">
                    <h2 id="text_success">Yêu Cầu Cập Nhật Đang Được Xử Lý</h2>
                  </div>
                  <button
                    type="submit"
                    class="tf-btn accent large mt-5"
                    data-bs-dismiss="modal"
                    onclick="location.reload()"
                  >
                    Đóng
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tf-panel up">
      <div class="panel_overlay"></div>
      <div class="panel-box panel-up wrap-panel-clear panel-change-profile">
        <div class="heading">
          <a href="#">Show Profile Picture</a>
          <a href="#">New Photo Shoot</a>
          <a href="#">Select Photo Form Device</a>
          <a href="#">Choose An Existing Avatar</a>
        </div>
        <div class="bottom">
          <a class="clear-panel" href="#">Dismiss</a>
        </div>
      </div>
    </div>
  </body>
  <script type="text/javascript" src="javascript/bootstrap.min.js"></script>
  <script type="text/javascript" src="javascript/jquery.min.js"></script>
  <script type="text/javascript" src="javascript/main.js"></script>
  <script>
    const pop_email = document.getElementById("pop_email");
    const pop_date = document.getElementById("pop_date");
    //
    const names = document.getElementById("name");
    const dates = document.getElementById("date");
    const rank = document.getElementById("rank");
    const phone = document.getElementById("phone");
    const email = document.getElementById("email");
    const point = document.getElementById("points");
    const gender = document.getElementById("gender");
    // const country = document.getElementById("country");
    // const address = document.getElementById("address");
    //
    function formatDate(date, type) {
      const day = String(date.getDate()).padStart(2, "0");
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const year = date.getFullYear();

      if (type == "revert") {
        return `${year}-${month}-${day}`;
      }
      return `${day}/${month}/${year}`;
    }
    const user = JSON.parse(localStorage.getItem("user"));
    const token = JSON.parse(localStorage.getItem("accessToken"));
    const HEADER_CONFIGs = {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer " + token,
      },
    };

    const rankName = {
      no: "Chưa xếp hạng",
      staff: "staff",
      silver: "Silver",
      gold: "Gold",
      platinum: "Platinum",
    };

    async function getProfile() {
      const data = await fetch(
        `https://priority-api.jemmia.vn/user/${user.id}`,
        HEADER_CONFIGs
      ).then((even) =>
        even.json().then((items) => {
          console.log(items.gender);
          // console.log(names);

          names.innerText = `${items.name}`;

          point.innerText = `${Math.floor(items?.point).toLocaleString(
            "vi-VN"
          )} POINTS`;
          phone.innerText = items.phoneNumber
            ? items.phoneNumber
            : "Chưa có số điện thoại";
          email.innerText = items.customerEmailUpdatePwa
            ? items.customerEmailUpdatePwa
            : "Chưa có email";
          pop_email.value = items.customerEmailUpdatePwa
            ? items.customerEmailUpdatePwa
            : "";

          rank.innerText =
            items?.rank == 0
              ? rankName.no
              : items?.rank == 1
              ? rankName.staff
              : items?.rank == 2
              ? rankName.silver
              : items?.rank == 3
              ? rankName.gold
              : items?.rank == 4
              ? rankName.platinum
              : "Chưa xếp hạng";
          //
          gender.innerText = `${
            items.gender != null
              ? items.gender == 1
                ? "Nữ"
                : "Nam"
              : "Không xác định"
          }`;
          // Date
          if (
            items.customerBirthdayUpdatePwa &&
            items.customerBirthdayUpdatePwa != "null"
          ) {
            var dateParts = items.customerBirthdayUpdatePwa.split("/");
            var year = Number(dateParts[2]);
            var month = Number(dateParts[1]); // Trừ đi 1 vì tháng trong đối tượng Date bắt đầu từ 0
            var day = Number(dateParts[0]);
            // var date = new Date(`${year}/${month}/${day}`);

            pop_date.value = items.customerBirthdayUpdatePwa
              ? `${year}-${month <= 9 ? `0${month}` : month}-${
                  day <= 9 ? `0${day}` : day
                }`
              : "";

            dates.innerText = items.customerBirthdayUpdatePwa
              ? `${day <= 9 ? `0${day}` : day}/${
                  month <= 9 ? `0${month}` : month
                }/${year}`
              : "Chưa có ngày sinh";
          } else {
            dates.innerText = "Chưa có ngày sinh";
          }
        })
      );
    }

    getProfile();
  </script>

  <script>
    const sendUpdate = document.getElementById("sendUpdate");
    const validEmail = document.getElementById("validEmail");
    const validDate = document.getElementById("validDate");
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const regexDate = /^(\d{4})-(\d{2})-(\d{2})$/;

    if (pop_date || pop_email) {
      validEmail.innerText = "";
      sendUpdate.disabled = false;
      sendUpdate.style.opacity = 1;
    }
    pop_email.addEventListener("input", (e) => {
      if (regex.test(pop_email.value)) {
        validEmail.innerText = "";
        sendUpdate.disabled = false;
        sendUpdate.style.opacity = 1;
      } else {
        if (pop_email.value == "") {
          validEmail.innerText = "Email không được để trống";
          sendUpdate.disabled = true;
          sendUpdate.style.opacity = 0.2;
        } else {
          validEmail.innerText = "Email không hợp lệ";
          sendUpdate.disabled = true;
          sendUpdate.style.opacity = 0.2;
        }
      }
    });

    pop_date.addEventListener("input", () => {
      console.log(pop_date.value);
      if (regexDate.test(pop_date.value)) {
        validDate.innerText = "";
        sendUpdate.disabled = false;
        sendUpdate.style.opacity = 1;
      } else {
        if (pop_date.value == "") {
          validDate.innerText = "Vui lòng nhập ngày sinh";
          sendUpdate.disabled = true;
          sendUpdate.style.opacity = 0.2;
        }
      }
    });
    async function SendUpdate() {
      const originalDate = new Date(pop_date.value);
      console.log(originalDate);
      const formattedDate = formatDate(originalDate);
      const payloads = {
        email: pop_email.value,
        birthday: formattedDate,
      };
      const headers = {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify(payloads),
      };

      if (
        regex.test(pop_email.value) ||
        pop_email.value != "" ||
        pop_date.value != ""
      ) {
        const sendUpdateAPI = fetch(
          "https://priority-api.jemmia.vn/user/crm/request-update-info",
          headers
        ).then((e) => {
          console.log(e);
        });
      } else {
        sendUpdate.disabled = true;
        sendUpdate.style.opacity = 0.2;
      }
    }

    sendUpdate.addEventListener("click", SendUpdate);
  </script>
</html>
